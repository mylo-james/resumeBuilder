# Story 1.2: Health Check & Integration Test Skeleton

## Status

Approved

## Story

**As a** developer, **I want** to add health check endpoints and an integration test, **so that** I can verify the
frontend and backend are communicating correctly.

## Acceptance Criteria

1. A new API route, `/health`, is created to act as a backend health check. It returns a 200 OK status code.
2. A basic frontend health check is implemented.
3. An integration test is written to verify that the frontend can successfully call the `/health` API route and receive
   the expected response.

## Tasks / Subtasks

- [x] Implement backend health check (AC: 1)
  - [x] Create `src/app/api/health/route.ts` that returns HTTP 200 with a minimal status payload
  - [x] Follow Next.js app router conventions for API routes [Source:
        architecture/architecture-project-structure.md#file-naming-conventions]
- [x] Implement frontend health check (AC: 2)
  - [x] Add a small utility to call `/api/health` from the frontend
  - [x] Surface a simple indicator in `src/app/page.tsx` (e.g., status text)
  - [x] Handle and log errors appropriately
- [x] Write tests (AC: 3)
  - [x] Unit tests for the health route (Jest)
  - [x] Integration test verifying frontend→backend call path
  - [x] Place tests under `tests/integration` and relevant unit test folder [Source:
        architecture/architecture-testing-strategy.md#test-file-organization]
- [x] Update CI to include the new tests
  - [x] Ensure GitHub Actions runs unit and integration suites [Source:
        architecture/architecture-testing-strategy.md#continuous-integration]

## Dev Notes

- Previous Story Insights
  - Builds on Story 1.1 project scaffolding and testing setup.

- Data Models
  - No specific guidance found in architecture docs for this story.

- API Specifications
  - Health check implemented as a simple Next.js API route under `src/app/api/health/route.ts` [Source:
    architecture/architecture-project-structure.md#srcapp]

- Component Specifications
  - Update `src/app/page.tsx` to display a lightweight health indicator [Source:
    architecture/architecture-project-structure.md#srcapp]

- File Locations
  - Unit tests should live near the closest logical unit test area; integration tests under `tests/integration` [Source:
    architecture/architecture-testing-strategy.md#test-file-organization]

- Testing Requirements
  - Use Jest for unit tests and implement an integration test that exercises the frontend→backend call [Source:
    architecture/architecture-testing-strategy.md#testing-pyramid-overview]

- Technical Constraints
  - Follow Next.js app router conventions for API routes [Source:
    architecture/architecture-project-structure.md#file-naming-conventions]

### Testing

- Test file location: `tests/integration` for integration tests; unit tests under the appropriate unit test area
  [Source: architecture/architecture-testing-strategy.md#test-file-organization]
- Test standards: TDD-first, meaningful names, aim for fast feedback [Source:
  architecture/architecture-testing-strategy.md#testing-best-practices]
- Frameworks/patterns: Jest for unit/integration [Source: architecture/architecture-tech-stack.md#tech-stack-overview]
- Story-specific: Integration test must assert successful call to `/api/health` (AC: 3)

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2024-12-19 | 1.0 | Implemented health check API route, frontend integration, and comprehensive test suite | James |

## Dev Agent Record

### Agent Model Used
- Full Stack Developer (James)

### Debug Log References
- Fixed Jest configuration to exclude Playwright integration tests from Jest runs
- Added polyfills for Request and Response objects in jest.setup.js
- Fixed TypeScript error in health API route test
- Resolved ESLint warning for console.error statement

### Completion Notes List
- Successfully implemented backend health check API route at `/api/health`
- Created frontend health check utility with proper error handling
- Added health status indicator to homepage with loading, success, and error states
- Implemented comprehensive unit tests for both API route and utility functions
- Created integration tests using Playwright to verify frontend→backend communication
- Updated Jest configuration to properly separate unit and integration tests
- All tests passing: 7 unit tests, 6 e2e/integration tests
- Code quality checks passing: linting, type checking

### File List
- `src/app/api/health/route.ts` - Backend health check API route
- `src/utils/health.ts` - Frontend health check utility
- `src/app/page.tsx` - Updated homepage with health status indicator
- `tests/unit/health.test.ts` - Unit tests for health API route
- `tests/unit/health-utils.test.ts` - Unit tests for health utility
- `tests/integration/health-integration.test.ts` - Integration tests for frontend→backend communication
- `jest.setup.js` - Updated with polyfills for Request/Response objects
- `jest.config.cjs` - Updated to exclude integration tests from Jest runs

## Critical Dev Flow

1. **Pull latest main**: `git pull origin main`
2. **Create story branch**: `git checkout -b feature/story-1.2-health-check-integration-test-skeleton`
3. **Follow Red-Green-Refactor cycle**:
   - **Red**: Write failing tests first
   - **Green**: Implement minimal code to make tests pass
   - **Refactor**: Clean up code while keeping tests green
4. **Fulfill requirements**: Complete all acceptance criteria
5. **Verify quality**:
   - Run tests: `npm test && npm run test:e2e`
   - Run linting: `npm run lint`
   - Run type checking: `npm run type-check`
6. **Commit and push**: `git push origin feature/story-1.2-health-check-integration-test-skeleton`
7. **Create PR**: Submit pull request for review
8. **Monitor CI**: Use `gh pr checks` to watch CI status and ensure all checks pass

## QA Results
