# Story 1.7: PDF Generation and Download

## Status

Draft

## Story

**As a** user, **I want** the application to generate and automatically download a PDF containing both the resume and
cover letter, **so that** I have a professional document ready for submission.

## Acceptance Criteria

1. jsPDF library is integrated for client-side PDF generation.
2. Handlebars templates are used to format the content for PDF output.
3. The PDF includes both resume and cover letter sections.
4. The PDF is automatically downloaded when generation is complete.
5. The PDF has professional formatting and styling.

## Tasks / Subtasks

- [ ] Install and configure jsPDF (AC: 1)
  - [ ] Install jsPDF: `npm install jspdf` [Source: architecture/architecture-tech-stack.md#tech-stack-overview]
  - [ ] Create PDF generation service structure
- [ ] Create PDF generation service (AC: 1, 2, 3)
  - [ ] Implement `src/lib/services/pdf-generator.ts` main PDF service [Source:
        architecture/architecture-project-structure.md#srclib]
  - [ ] Create `src/lib/templates/pdf-resume.hbs` PDF-specific resume template [Source:
        architecture/architecture-project-structure.md#srclib]
  - [ ] Create `src/lib/templates/pdf-cover-letter.hbs` PDF-specific cover letter template [Source:
        architecture/architecture-project-structure.md#srclib]
  - [ ] Create `src/lib/utils/pdf-styling.ts` for PDF styling utilities [Source:
        architecture/architecture-project-structure.md#srclib]
  - [ ] Implement professional styling and layout
- [ ] Implement automatic download (AC: 4)
  - [ ] Add PDF generation button to UI
  - [ ] Implement automatic download trigger
  - [ ] Add loading state during PDF generation
  - [ ] Handle PDF generation errors
- [ ] Ensure professional formatting (AC: 5)
  - [ ] Implement professional typography and spacing
  - [ ] Ensure consistent formatting across sections
  - [ ] Handle page breaks for long content
  - [ ] Add header and footer with branding
  - [ ] Create print-friendly layout
- [ ] Write comprehensive tests
  - [ ] Unit tests for PDF generation service [Source:
        architecture/architecture-testing-strategy.md#testing-pyramid-overview]
  - [ ] Integration tests for PDF creation and download [Source:
        architecture/architecture-testing-strategy.md#testing-pyramid-overview]
  - [ ] E2E tests for complete PDF generation and download flow [Source:
        architecture/architecture-testing-strategy.md#testing-pyramid-overview]

## Dev Notes

- Previous Story Insights
  - Builds on Stories 1.5 and 1.6's AI generation and content processing.
  - Uses existing Handlebars templates and content structure.

- Data Models
  - PDF document structure: `{ resume: ResumeData, coverLetter: CoverLetterData }`
  - PDF styling configuration for professional formatting
  - Download response format with file metadata

- API Specifications
  - Client-side PDF generation using jsPDF (no new API endpoints)
  - Integrates with existing content from AI generation
  - Automatic download functionality

- Component Specifications
  - Add PDF generation button to existing UI components
  - Implement loading states for PDF generation
  - Add error handling for PDF generation failures
  - Maintain existing UI components and functionality

- File Locations
  - PDF service: `src/lib/services/pdf-generator.ts` [Source: architecture/architecture-project-structure.md#srclib]
  - PDF templates: `src/lib/templates/pdf-*.hbs` [Source: architecture/architecture-project-structure.md#srclib]
  - PDF styling: `src/lib/utils/pdf-styling.ts` [Source: architecture/architecture-project-structure.md#srclib]

- Testing Requirements
  - Test PDF generation with various content lengths [Source:
    architecture/architecture-testing-strategy.md#testing-pyramid-overview]
  - Verify PDF formatting and styling [Source: architecture/architecture-testing-strategy.md#testing-pyramid-overview]
  - Test download functionality and error handling [Source:
    architecture/architecture-testing-strategy.md#testing-pyramid-overview]

- Technical Constraints
  - Client-side PDF generation using jsPDF [Source: architecture/architecture-tech-stack.md#tech-stack-overview]
  - Professional formatting requirements
  - Browser download limitations and handling

### Testing

- Test file location: Unit tests near services, integration tests under `tests/integration/`, E2E tests under
  `tests/e2e/` [Source: architecture/architecture-testing-strategy.md#test-file-organization]
- Test standards: Test PDF generation, verify formatting, test download functionality [Source:
  architecture/architecture-testing-strategy.md#testing-best-practices]
- Frameworks/patterns: Jest for unit/integration, Playwright for E2E with download testing [Source:
  architecture/architecture-tech-stack.md#tech-stack-overview]
- Story-specific: Test PDF generation, professional formatting, automatic download, error handling

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## Critical Dev Flow

1. **Pull latest main**: `git pull origin main`
2. **Create story branch**: `git checkout -b feature/story-1.7-pdf-generation-and-download`
3. **Follow Red-Green-Refactor cycle**:
   - **Red**: Write failing tests first
   - **Green**: Implement minimal code to make tests pass
   - **Refactor**: Clean up code while keeping tests green
4. **Fulfill requirements**: Complete all acceptance criteria
5. **Verify quality**:
   - Run tests: `npm test && npm run test:e2e`
   - Run linting: `npm run lint`
   - Run type checking: `npm run type-check`
6. **Commit and push**: `git push origin feature/story-1.7-pdf-generation-and-download`
7. **Create PR**: Submit pull request for review
8. **Monitor CI**: Use `gh pr checks` to watch CI status and ensure all checks pass

## QA Results
